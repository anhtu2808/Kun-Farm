@page "/leaderboard"
@model KunFarm.Presentation.Pages.Leaderboard.IndexModel
@{
    ViewData["Title"] = "Bảng Xếp Hạng KunFarm";
}

<!-- Header Section -->
<div class="relative bg-gradient-to-r from-farm-yellow to-orange-400 rounded-2xl p-6 md:p-8 mb-8 overflow-hidden">
    <div class="absolute inset-0 bg-black opacity-10 rounded-2xl"></div>
    <div class="relative z-10 text-white">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
            <div>
                <h1 class="text-3xl md:text-4xl font-bold mb-2">
                    <i class="fas fa-trophy mr-3 text-farm-yellow"></i>
                    Bảng Xếp Hạng KunFarm
                </h1>
                <p class="text-lg opacity-90">
                    Theo dõi thành tích của những nông dân xuất sắc nhất
                </p>
            </div>
            <!-- Decorative farm icons -->
            <div class="hidden md:flex space-x-4 text-farm-yellow opacity-30">
                <i class="fas fa-medal text-4xl"></i>
                <i class="fas fa-crown text-4xl"></i>
                <i class="fas fa-star text-4xl"></i>
            </div>
        </div>
    </div>
</div>

<!-- Tabs Navigation -->
<div class="bg-white rounded-2xl shadow-lg mb-6 overflow-hidden">
    <div class="flex flex-col sm:flex-row border-b border-gray-200">
        <button class="tab-button active-tab flex-1 p-4 text-center font-semibold transition-all duration-200 hover:bg-farm-yellow/10" 
                data-tab="money" onclick="switchTab('money')">
            <i class="fas fa-coins text-farm-yellow mr-2"></i>
            <span class="hidden sm:inline">Top </span>Tiền
        </button>
        <button class="tab-button flex-1 p-4 text-center font-semibold transition-all duration-200 hover:bg-red-50" 
                data-tab="health" onclick="switchTab('health')">
            <i class="fas fa-heart text-red-500 mr-2"></i>
            <span class="hidden sm:inline">Top </span>Sức Khỏe
        </button>
        <button class="tab-button flex-1 p-4 text-center font-semibold transition-all duration-200 hover:bg-green-50" 
                data-tab="hunger" onclick="switchTab('hunger')">
            <i class="fas fa-drumstick-bite text-farm-green mr-2"></i>
            <span class="hidden sm:inline">Top </span>Độ Đói
        </button>
    </div>
</div>

<!-- Leaderboard Content -->
<div class="bg-white rounded-2xl shadow-lg overflow-hidden">
    <!-- Money Leaderboard -->
    <div id="money-content" class="tab-content active-content p-6">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6">
            <h2 class="text-2xl font-bold text-gray-900 flex items-center mb-4 sm:mb-0">
                <i class="fas fa-coins text-farm-yellow mr-3"></i>
                Xếp Hạng Theo Tiền
            </h2>
            <button onclick="loadMoneyLeaderboard()" 
                    class="bg-farm-yellow hover:bg-yellow-500 text-gray-900 px-4 py-2 rounded-lg font-semibold transition-colors duration-200 flex items-center">
                <i class="fas fa-sync-alt mr-2"></i>
                Làm mới
            </button>
        </div>
        
        <!-- Top 3 Podium -->
        <div id="money-podium" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
            <!-- Podium will be generated by JavaScript -->
        </div>
        
        <!-- Leaderboard Table -->
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="bg-gradient-to-r from-farm-yellow to-yellow-400 text-gray-900">
                    <tr>
                        <th class="px-4 py-3 text-left font-semibold">Hạng</th>
                        <th class="px-4 py-3 text-left font-semibold">Người chơi</th>
                        <th class="px-4 py-3 text-left font-semibold hidden sm:table-cell">Tên hiển thị</th>
                        <th class="px-4 py-3 text-right font-semibold">Số tiền</th>
                        <th class="px-4 py-3 text-right font-semibold hidden md:table-cell">Sức khỏe</th>
                        <th class="px-4 py-3 text-right font-semibold hidden lg:table-cell">Lần cuối</th>
                    </tr>
                </thead>
                <tbody id="moneyLeaderboardBody" class="divide-y divide-gray-200">
                    <!-- Data will be loaded here -->
                </tbody>
            </table>
        </div>
        
        <div id="moneyLoadingIndicator" class="text-center py-8 hidden">
            <div class="inline-flex items-center px-4 py-2 rounded-lg bg-farm-yellow/10">
                <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-farm-yellow" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <span class="text-farm-yellow font-semibold">Đang tải bảng xếp hạng...</span>
            </div>
        </div>
    </div>

    <!-- Health Leaderboard -->
    <div id="health-content" class="tab-content hidden p-6">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6">
            <h2 class="text-2xl font-bold text-gray-900 flex items-center mb-4 sm:mb-0">
                <i class="fas fa-heart text-red-500 mr-3"></i>
                Xếp Hạng Theo Sức Khỏe
            </h2>
            <button onclick="loadHealthLeaderboard()" 
                    class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-semibold transition-colors duration-200 flex items-center">
                <i class="fas fa-sync-alt mr-2"></i>
                Làm mới
            </button>
        </div>
        
        <!-- Top 3 Podium -->
        <div id="health-podium" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
            <!-- Podium will be generated by JavaScript -->
        </div>
        
        <!-- Leaderboard Table -->
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="bg-gradient-to-r from-red-500 to-red-600 text-white">
                    <tr>
                        <th class="px-4 py-3 text-left font-semibold">Hạng</th>
                        <th class="px-4 py-3 text-left font-semibold">Người chơi</th>
                        <th class="px-4 py-3 text-left font-semibold hidden sm:table-cell">Tên hiển thị</th>
                        <th class="px-4 py-3 text-right font-semibold">Sức khỏe</th>
                        <th class="px-4 py-3 text-right font-semibold hidden md:table-cell">Số tiền</th>
                        <th class="px-4 py-3 text-right font-semibold hidden lg:table-cell">Lần cuối</th>
                    </tr>
                </thead>
                <tbody id="healthLeaderboardBody" class="divide-y divide-gray-200">
                    <!-- Data will be loaded here -->
                </tbody>
            </table>
        </div>
        
        <div id="healthLoadingIndicator" class="text-center py-8 hidden">
            <div class="inline-flex items-center px-4 py-2 rounded-lg bg-red-50">
                <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-red-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <span class="text-red-500 font-semibold">Đang tải bảng xếp hạng...</span>
            </div>
        </div>
    </div>

    <!-- Hunger Leaderboard -->
    <div id="hunger-content" class="tab-content hidden p-6">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6">
            <h2 class="text-2xl font-bold text-gray-900 flex items-center mb-4 sm:mb-0">
                <i class="fas fa-drumstick-bite text-farm-green mr-3"></i>
                Xếp Hạng Theo Độ Đói
            </h2>
            <button onclick="loadHungerLeaderboard()" 
                    class="bg-farm-green hover:bg-green-600 text-white px-4 py-2 rounded-lg font-semibold transition-colors duration-200 flex items-center">
                <i class="fas fa-sync-alt mr-2"></i>
                Làm mới
            </button>
        </div>
        
        <!-- Top 3 Podium -->
        <div id="hunger-podium" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
            <!-- Podium will be generated by JavaScript -->
        </div>
        
        <!-- Leaderboard Table -->
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="bg-gradient-to-r from-farm-green to-green-600 text-white">
                    <tr>
                        <th class="px-4 py-3 text-left font-semibold">Hạng</th>
                        <th class="px-4 py-3 text-left font-semibold">Người chơi</th>
                        <th class="px-4 py-3 text-left font-semibold hidden sm:table-cell">Tên hiển thị</th>
                        <th class="px-4 py-3 text-right font-semibold">Độ đói</th>
                        <th class="px-4 py-3 text-right font-semibold hidden md:table-cell">Sức khỏe</th>
                        <th class="px-4 py-3 text-right font-semibold hidden lg:table-cell">Lần cuối</th>
                    </tr>
                </thead>
                <tbody id="hungerLeaderboardBody" class="divide-y divide-gray-200">
                    <!-- Data will be loaded here -->
                </tbody>
            </table>
        </div>
        
        <div id="hungerLoadingIndicator" class="text-center py-8 hidden">
            <div class="inline-flex items-center px-4 py-2 rounded-lg bg-green-50">
                <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-farm-green" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <span class="text-farm-green font-semibold">Đang tải bảng xếp hạng...</span>
            </div>
        </div>
    </div>
</div>

<!-- Statistics Section -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8">
    <div class="bg-white rounded-2xl shadow-lg p-6 text-center">
        <div class="bg-farm-blue p-4 rounded-full w-16 h-16 mx-auto mb-4 flex items-center justify-center">
            <i class="fas fa-users text-white text-2xl"></i>
        </div>
        <h3 class="text-lg font-semibold text-gray-700 mb-2">Tổng số người chơi</h3>
        <p class="text-3xl font-bold text-farm-blue" id="totalPlayersCount">
            <span class="animate-pulse bg-blue-200 h-8 w-16 mx-auto rounded inline-block"></span>
        </p>
    </div>
    
    <div class="bg-white rounded-2xl shadow-lg p-6 text-center">
        <div class="bg-farm-green p-4 rounded-full w-16 h-16 mx-auto mb-4 flex items-center justify-center">
            <i class="fas fa-user-check text-white text-2xl"></i>
        </div>
        <h3 class="text-lg font-semibold text-gray-700 mb-2">Đang hoạt động</h3>
        <p class="text-3xl font-bold text-farm-green" id="activePlayersCount">
            <span class="animate-pulse bg-green-200 h-8 w-16 mx-auto rounded inline-block"></span>
        </p>
    </div>
    
    <div class="bg-white rounded-2xl shadow-lg p-6 text-center">
        <div class="bg-farm-yellow p-4 rounded-full w-16 h-16 mx-auto mb-4 flex items-center justify-center">
            <i class="fas fa-clock text-gray-900 text-2xl"></i>
        </div>
        <h3 class="text-lg font-semibold text-gray-700 mb-2">Cập nhật lần cuối</h3>
        <p class="text-lg font-semibold text-farm-yellow" id="lastUpdated">
            <span class="animate-pulse bg-yellow-200 h-6 w-24 mx-auto rounded inline-block"></span>
        </p>
    </div>
</div>

<!-- Player Detail Modal -->
<div id="playerDetailModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <div class="flex justify-between items-center p-6 border-b border-gray-200">
            <h3 class="text-xl font-bold text-gray-900">Chi tiết người chơi</h3>
            <button onclick="closePlayerModal()" class="text-gray-400 hover:text-gray-600 transition-colors duration-200">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>
        <div class="p-6">
            <div id="playerDetailContent">
                <!-- Player details will be loaded here -->
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/leaderboard.js" asp-append-version="true"></script>
    <script>
        let currentTab = 'money';

        function switchTab(tab) {
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active-tab');
                btn.classList.add('text-gray-600');
            });
            document.querySelector(`[data-tab="${tab}"]`).classList.add('active-tab');
            document.querySelector(`[data-tab="${tab}"]`).classList.remove('text-gray-600');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
                content.classList.remove('active-content');
            });
            document.getElementById(`${tab}-content`).classList.remove('hidden');
            document.getElementById(`${tab}-content`).classList.add('active-content');

            currentTab = tab;

            // Load data for the selected tab
            switch(tab) {
                case 'money':
                    loadMoneyLeaderboard();
                    break;
                case 'health':
                    loadHealthLeaderboard();
                    break;
                case 'hunger':
                    loadHungerLeaderboard();
                    break;
            }
        }

        function closePlayerModal() {
            document.getElementById('playerDetailModal').classList.add('hidden');
        }

        // CSS for active tab
        document.addEventListener('DOMContentLoaded', function() {
            const style = document.createElement('style');
            style.textContent = `
                .active-tab {
                    background: linear-gradient(135deg, var(--tw-gradient-from), var(--tw-gradient-to));
                    color: white;
                    border-bottom: 3px solid #fbbf24;
                }
                .tab-button[data-tab="money"].active-tab {
                    background: linear-gradient(135deg, #fbbf24, #f59e0b);
                }
                .tab-button[data-tab="health"].active-tab {
                    background: linear-gradient(135deg, #ef4444, #dc2626);
                }
                .tab-button[data-tab="hunger"].active-tab {
                    background: linear-gradient(135deg, #4ade80, #16a34a);
                }
            `;
            document.head.appendChild(style);
        });
    </script>
} 